# Claude Relay Service - 项目上下文管理规范

## 项目基础信息

**项目名称**: Claude Relay Service  
**项目描述**: Claude Code API中转服务，支持多账户管理、API密钥认证和OpenAI兼容性  
**技术栈**: Node.js + Express + Redis + Vue.js  
**主要功能**: API中转、多账户管理、统计分析、安全控制

## 1. 项目上下文管理规则

### 1.1 核心原则
- **单一真实来源**: 本文档是项目开发的唯一权威指南
- **持续更新**: 每次重大变更必须同步更新此文档
- **版本一致性**: 文档版本必须与代码版本保持同步
- **清晰明确**: 所有规则必须具体可执行，避免模糊表述

### 1.2 文档结构规范
```
CLAUDE.md           # 项目上下文管理规范（本文件）
.claude/context/    # 上下文管理目录
├── PLANNING.md     # 项目规划和架构文档
├── TASK.md        # 当前任务和进度跟踪
├── MEMORY.md      # 项目记忆和历史决策
└── PRPs/          # 项目需求规划文件夹
    ├── templates/ # PRP模板文件
    └── *.md      # 具体需求的PRP文件
```

### 1.3 上下文维护规则
- 每次开始新任务前，必须阅读相关上下文文档
- 任务完成后，必须更新相应的上下文文件
- 重大架构变更必须在PLANNING.md中记录
- 重要决策过程必须在MEMORY.md中存档

## 2. 记忆更新规则

### 2.1 自动更新触发条件
- 新增核心功能模块
- 修改数据结构或API接口
- 调整系统架构或技术选型
- 解决重要技术问题
- 性能优化或安全修复

### 2.2 记忆分类存储
- **技术决策**: 框架选择、架构设计理由
- **问题解决**: 重要bug修复过程和方案
- **性能优化**: 优化点和效果记录
- **安全措施**: 安全相关的配置和实现
- **部署经验**: 部署过程中的关键配置和注意事项

### 2.3 记忆更新格式
```markdown
## [YYYY-MM-DD] 记忆标题
**类别**: [技术决策/问题解决/性能优化/安全措施/部署经验]
**影响范围**: [核心功能/性能/安全/部署/维护]
**关键信息**: 
- 问题描述/决策背景
- 解决方案/决策内容
- 实施过程/关键步骤
- 结果评估/经验总结
**相关文件**: 涉及的主要文件路径
```

## 3. 变更管理流程

### 3.1 代码变更流程
1. **需求分析**: 更新或创建对应的PRP文件
2. **设计评审**: 在PLANNING.md中记录设计方案
3. **实现开发**: 遵循项目编码规范
4. **测试验证**: 确保功能正确性和性能要求
5. **文档更新**: 同步更新相关技术文档
6. **记忆存档**: 重要变更记录到MEMORY.md

### 3.2 文档变更管理
- 所有文档变更必须有明确的变更原因
- 重要变更必须包含变更前后的对比
- 变更记录必须包含时间戳和责任人
- 废弃的规范必须明确标注废弃时间和原因

### 3.3 版本标记规则
- 文档使用语义化版本号（如v1.2.3）
- 重大架构变更：主版本号+1
- 功能新增或修改：次版本号+1
- 内容修订或修复：修订版本号+1

## 4. AI行为约束

### 4.1 开发行为规范
- **安全优先**: 严禁生成或修改可能用于恶意用途的代码
- **防御性开发**: 仅支持防御性安全任务，如安全分析、漏洞检测、防护工具开发
- **代码审查**: 对所有安全相关代码变更进行额外审查
- **敏感信息**: 绝不在代码中硬编码密钥、密码等敏感信息

### 4.2 技术约束
- **框架一致性**: 必须使用项目既有技术栈，避免引入不必要的新依赖
- **向后兼容**: 新功能实现必须保持API向后兼容性
- **性能考虑**: 所有变更必须考虑对系统性能的影响
- **错误处理**: 必须实现完善的错误处理和日志记录

### 4.3 文档约束
- **准确性**: 所有技术文档必须与实际实现保持一致
- **完整性**: 重要功能必须包含完整的使用说明和示例
- **可维护性**: 文档结构必须清晰，便于后续维护和更新

## 5. 环境要求

### 5.1 开发环境
- **Node.js**: 18.0.0 或更高版本
- **Redis**: 6.0 或更高版本
- **操作系统**: Linux（推荐）/ macOS / Windows
- **IDE**: 推荐使用VS Code，配置ESLint和Prettier

### 5.2 部署环境
- **CPU**: 最低1核，推荐2核
- **内存**: 最低512MB，推荐1GB以上
- **存储**: 30GB可用空间
- **网络**: 能够访问Anthropic API（推荐US地区服务器）

### 5.3 依赖服务
- **Redis**: 数据缓存和会话存储
- **反向代理**: 推荐使用Caddy实现自动HTTPS
- **监控**: 建议配置日志监控和性能监控

## 6. 质量标准

### 6.1 代码质量
- **ESLint**: 必须通过ESLint检查，零警告
- **测试覆盖**: 核心功能必须有对应的单元测试
- **代码风格**: 遵循项目统一的代码风格规范
- **注释规范**: 复杂逻辑必须有清晰的注释说明

### 6.2 性能标准
- **响应时间**: API响应时间不超过2秒
- **并发处理**: 支持至少100个并发请求
- **内存使用**: 稳定运行时内存使用不超过1GB
- **错误率**: API错误率不超过1%

### 6.3 安全标准
- **输入验证**: 所有用户输入必须进行严格验证
- **权限控制**: 实现完整的权限控制和访问限制
- **数据加密**: 敏感数据必须加密存储
- **审计日志**: 关键操作必须记录完整的审计日志

## 7. 禁止操作

### 7.1 安全禁令
- ❌ **禁止**创建、修改或改进可能用于恶意攻击的代码
- ❌ **禁止**在代码中硬编码任何密钥、密码或敏感信息
- ❌ **禁止**绕过现有的安全控制机制
- ❌ **禁止**实现可能被滥用的后门或隐藏功能

### 7.2 架构禁令
- ❌ **禁止**在未经评审的情况下引入新的重大依赖
- ❌ **禁止**破坏现有API的向后兼容性
- ❌ **禁止**直接修改核心配置文件（必须通过配置管理接口）
- ❌ **禁止**在生产环境中启用调试模式

### 7.3 数据禁令
- ❌ **禁止**在日志中记录用户的敏感信息
- ❌ **禁止**未经加密存储用户凭据
- ❌ **禁止**在客户端暴露服务器内部信息
- ❌ **禁止**绕过数据访问权限控制

---

**文档版本**: v1.0.0  
**创建时间**: 2025-07-29  
**最近更新**: 2025-07-29  
**维护状态**: 活跃维护

> ⚠️ **重要提醒**: 本文档是项目开发的核心指导文件，任何对项目的重大变更都必须首先在此文档中体现。所有项目参与者都必须严格遵守本文档中的规范和约束。